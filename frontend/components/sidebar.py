"""Sidebar component â€” language selector, quick links, branding."""

from __future__ import annotations

import streamlit as st

from backend.config import Config

# â”€â”€ Language display names in their own script â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
LANGUAGE_LABELS: dict[str, str] = {
    "en": "English",
    "te": "à°¤à±†à°²à±à°—à± (Telugu)",
    "hi": "à¤¹à¤¿à¤¨à¥à¤¦à¥€ (Hindi)",
    "ta": "à®¤à®®à®¿à®´à¯ (Tamil)",
    "kn": "à²•à²¨à³à²¨à²¡ (Kannada)",
    "ml": "à´®à´²à´¯à´¾à´³à´‚ (Malayalam)",
    "bn": "à¦¬à¦¾à¦‚à¦²à¦¾ (Bengali)",
    "mr": "à¤®à¤°à¤¾à¤ à¥€ (Marathi)",
    "gu": "àª—à«àªœàª°àª¾àª¤à«€ (Gujarati)",
    "pa": "à¨ªà©°à¨œà¨¾à¨¬à©€ (Punjabi)",
    "or": "à¬“à¬¡à¬¼à¬¿à¬† (Odia)",
    "as": "à¦…à¦¸à¦®à§€à¦¯à¦¼à¦¾ (Assamese)",
}

# â”€â”€ Greeting per language â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GREETINGS: dict[str, str] = {
    "en": "Hello! I am KrishiSaathi â€” your AI farming companion. Ask me anything about crops, weather, market prices, government schemes, or soil health!",
    "te": "à°¨à°®à°¸à±à°•à°¾à°°à°‚! à°¨à±‡à°¨à± à°•à±ƒà°·à°¿à°¸à°¾à°¥à°¿ â€” à°®à±€ AI à°µà±à°¯à°µà°¸à°¾à°¯ à°¸à°¹à°šà°°à±à°¡à±. à°ªà°‚à°Ÿà°²à±, à°µà°¾à°¤à°¾à°µà°°à°£à°‚, à°®à°¾à°°à±à°•à±†à°Ÿà± à°§à°°à°²à±, à°ªà±à°°à°­à±à°¤à±à°µ à°ªà°¥à°•à°¾à°²à± à°²à±‡à°¦à°¾ à°¨à±‡à°² à°†à°°à±‹à°—à±à°¯à°‚ à°—à±à°°à°¿à°‚à°šà°¿ à°à°¦à±ˆà°¨à°¾ à°…à°¡à°—à°‚à°¡à°¿!",
    "hi": "à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤®à¥ˆà¤‚ à¤•à¥ƒà¤·à¤¿à¤¸à¤¾à¤¥à¥€ à¤¹à¥‚à¤‚ â€” à¤†à¤ªà¤•à¤¾ AI à¤–à¥‡à¤¤à¥€ à¤¸à¤¹à¤¾à¤¯à¤•à¥¤ à¤«à¤¸à¤², à¤®à¥Œà¤¸à¤®, à¤¬à¤¾à¤œà¤¾à¤° à¤­à¤¾à¤µ, à¤¸à¤°à¤•à¤¾à¤°à¥€ à¤¯à¥‹à¤œà¤¨à¤¾à¤à¤‚ à¤¯à¤¾ à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ â€” à¤•à¥à¤› à¤­à¥€ à¤ªà¥‚à¤›à¥‡à¤‚!",
    "ta": "à®µà®£à®•à¯à®•à®®à¯! à®¨à®¾à®©à¯ à®•à®¿à®°à¯à®·à®¿à®šà®¾à®¤à¯à®¤à®¿ â€” à®‰à®™à¯à®•à®³à¯ AI à®µà®¿à®µà®šà®¾à®¯ à®¤à¯‹à®´à®©à¯. à®ªà®¯à®¿à®°à¯à®•à®³à¯, à®µà®¾à®©à®¿à®²à¯ˆ, à®šà®¨à¯à®¤à¯ˆ à®µà®¿à®²à¯ˆà®•à®³à¯, à®…à®°à®šà¯ à®¤à®¿à®Ÿà¯à®Ÿà®™à¯à®•à®³à¯ à®…à®²à¯à®²à®¤à¯ à®®à®£à¯ à®†à®°à¯‹à®•à¯à®•à®¿à®¯à®®à¯ à®ªà®±à¯à®±à®¿ à®à®¤à¯ˆà®¯à¯à®®à¯ à®•à¯‡à®³à¯à®™à¯à®•à®³à¯!",
    "kn": "à²¨à²®à²¸à³à²•à²¾à²°! à²¨à²¾à²¨à³ à²•à³ƒà²·à²¿à²¸à²¾à²¥à²¿ â€” à²¨à²¿à²®à³à²® AI à²•à³ƒà²·à²¿ à²¸à²¹à²šà²°. à²¬à³†à²³à³†à²—à²³à³, à²¹à²µà²¾à²®à²¾à²¨, à²®à²¾à²°à³à²•à²Ÿà³à²Ÿà³† à²¬à³†à²²à³†à²—à²³à³, à²¸à²°à³à²•à²¾à²°à²¿ à²¯à³‹à²œà²¨à³†à²—à²³à³ à²…à²¥à²µà²¾ à²®à²£à³à²£à²¿à²¨ à²†à²°à³‹à²—à³à²¯à²¦ à²¬à²—à³à²—à³† à²à²¨à²¨à³à²¨à²¾à²¦à²°à³‚ à²•à³‡à²³à²¿!",
    "ml": "à´¨à´®à´¸àµà´•à´¾à´°à´‚! à´à´¾àµ» à´•àµƒà´·à´¿à´¸à´¾à´¤àµà´¤à´¿ â€” à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† AI à´•àµƒà´·à´¿ à´¸à´¹à´¾à´¯à´¿. à´µà´¿à´³à´•àµ¾, à´•à´¾à´²à´¾à´µà´¸àµà´¥, à´µà´¿à´ªà´£à´¿ à´µà´¿à´²à´•àµ¾, à´¸àµ¼à´•àµà´•à´¾àµ¼ à´ªà´¦àµà´§à´¤à´¿à´•àµ¾, à´®à´£àµà´£àµ à´†à´°àµ‹à´—àµà´¯à´‚ â€” à´à´¨àµà´¤àµà´‚ à´šàµ‹à´¦à´¿à´•àµà´•àµ‚!",
    "bn": "à¦¨à¦®à¦¸à§à¦•à¦¾à¦°! à¦†à¦®à¦¿ à¦•à§ƒà¦·à¦¿à¦¸à¦¾à¦¥à§€ â€” à¦†à¦ªà¦¨à¦¾à¦° AI à¦•à§ƒà¦·à¦¿ à¦¸à¦¹à¦¾à¦¯à¦¼à¦•à¥¤ à¦«à¦¸à¦², à¦†à¦¬à¦¹à¦¾à¦“à¦¯à¦¼à¦¾, à¦¬à¦¾à¦œà¦¾à¦° à¦¦à¦°, à¦¸à¦°à¦•à¦¾à¦°à¦¿ à¦ªà§à¦°à¦•à¦²à§à¦ª à¦¬à¦¾ à¦®à¦¾à¦Ÿà¦¿ à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯ â€” à¦¯à§‡à¦•à§‹à¦¨à§‹ à¦ªà§à¦°à¦¶à§à¦¨ à¦•à¦°à§à¦¨!",
    "mr": "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! à¤®à¥€ à¤•à¥ƒà¤·à¤¿à¤¸à¤¾à¤¥à¥€ à¤†à¤¹à¥‡ â€” à¤¤à¥à¤®à¤šà¤¾ AI à¤¶à¥‡à¤¤à¥€ à¤¸à¤¹à¤¾à¤¯à¤•. à¤ªà¤¿à¤•à¥‡, à¤¹à¤µà¤¾à¤®à¤¾à¤¨, à¤¬à¤¾à¤œà¤¾à¤°à¤­à¤¾à¤µ, à¤¸à¤°à¤•à¤¾à¤°à¥€ à¤¯à¥‹à¤œà¤¨à¤¾ à¤•à¤¿à¤‚à¤µà¤¾ à¤®à¤¾à¤¤à¥€à¤šà¥‡ à¤†à¤°à¥‹à¤—à¥à¤¯ â€” à¤•à¤¾à¤¹à¥€à¤¹à¥€ à¤µà¤¿à¤šà¤¾à¤°à¤¾!",
    "gu": "àª¨àª®àª¸à«àª¤à«‡! àª¹à«àª‚ àª•à«ƒàª·àª¿àª¸àª¾àª¥à«€ â€” àª¤àª®àª¾àª°à«‹ AI àª–à«‡àª¤à«€ àª¸àª¹àª¾àª¯àª•. àªªàª¾àª•, àª¹àªµàª¾àª®àª¾àª¨, àª¬àªœàª¾àª° àª­àª¾àªµ, àª¸àª°àª•àª¾àª°à«€ àª¯à«‹àªœàª¨àª¾àª“ àª…àª¥àªµàª¾ àªœàª®à«€àª¨ àª†àª°à«‹àª—à«àª¯ â€” àª•àª‚àªˆ àªªàª£ àªªà«‚àª›à«‹!",
    "pa": "à¨¸à¨¤ à¨¸à©à¨°à©€ à¨…à¨•à¨¾à¨²! à¨®à©ˆà¨‚ à¨•à©à¨°à¨¿à¨¸à¨¼à©€à¨¸à¨¾à¨¥à©€ â€” à¨¤à©à¨¹à¨¾à¨¡à¨¾ AI à¨–à©‡à¨¤à©€ à¨¸à¨¹à¨¾à¨‡à¨•à¥¤ à¨«à¨¼à¨¸à¨²à¨¾à¨‚, à¨®à©Œà¨¸à¨®, à¨®à©°à¨¡à©€ à¨­à¨¾à¨…, à¨¸à¨°à¨•à¨¾à¨°à©€ à¨¯à©‹à¨œà¨¨à¨¾à¨µà¨¾à¨‚ à¨œà¨¾à¨‚ à¨®à¨¿à©±à¨Ÿà©€ à¨¸à¨¿à¨¹à¨¤ â€” à¨•à©à¨ à¨µà©€ à¨ªà©à©±à¨›à©‹!",
    "or": "à¬¨à¬®à¬¸à­à¬•à¬¾à¬°! à¬®à­à¬ à¬•à­ƒà¬·à¬¿à¬¸à¬¾à¬¥à­€ â€” à¬†à¬ªà¬£à¬™à­à¬• AI à¬šà¬¾à¬· à¬¸à¬¹à¬¾à­Ÿà¬•à¥¤ à¬«à¬¸à¬², à¬ªà¬¾à¬£à¬¿à¬ªà¬¾à¬—, à¬¬à¬œà¬¾à¬° à¬¦à¬°, à¬¸à¬°à¬•à¬¾à¬°à­€ à¬¯à­‹à¬œà¬¨à¬¾ à¬¬à¬¾ à¬®à¬¾à¬Ÿà¬¿ à¬¸à­à­±à¬¾à¬¸à­à¬¥à­à­Ÿ â€” à¬¯à¬¾à¬¹à¬¾ à¬¬à¬¿ à¬ªà¬šà¬¾à¬°à¬¨à­à¬¤à­!",
    "as": "à¦¨à¦®à¦¸à§à¦•à¦¾à§°! à¦®à¦‡ à¦•à§ƒà¦·à¦¿à¦¸à¦¾à¦¥à§€ â€” à¦†à¦ªà§‹à¦¨à¦¾à§° AI à¦•à§ƒà¦·à¦¿ à¦¸à¦¹à¦¾à¦¯à¦¼à¦•à¥¤ à¦¶à¦¸à§à¦¯, à¦¬à¦¤à§°, à¦¬à¦œà¦¾à§° à¦®à§‚à¦²à§à¦¯, à¦šà§°à¦•à¦¾à§°à§€ à¦†à¦à¦šà¦¨à¦¿ à¦¬à¦¾ à¦®à¦¾à¦Ÿà¦¿à§° à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯ â€” à¦¯à¦¿à¦•à§‹à¦¨à§‹ à¦•à¦¥à¦¾ à¦¸à§‹à¦§à¦•!",
}

# â”€â”€ Quick-action labels per language â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
QUICK_ACTIONS: dict[str, list[tuple[str, str]]] = {
    "en": [
        ("ğŸŒ± Crop Disease", "My crop has a disease, help me diagnose it"),
        ("ğŸ’° Market Prices", "What are today's mandi prices for rice?"),
        ("ğŸ›ï¸ Govt Schemes", "What government schemes am I eligible for?"),
        ("ğŸŒ¤ï¸ Weather", "What is the weather forecast for my area?"),
        ("ğŸ§ª Soil Health", "Recommend fertilizers for my red soil"),
    ],
    "te": [
        ("ğŸŒ± à°ªà°‚à°Ÿ à°µà±à°¯à°¾à°§à°¿", "à°¨à°¾ à°ªà°‚à°Ÿà°•à± à°µà±à°¯à°¾à°§à°¿ à°µà°šà±à°šà°¿à°‚à°¦à°¿, à°¨à°¿à°°à±à°§à°¾à°°à°£ à°šà±‡à°¯à°‚à°¡à°¿"),
        ("ğŸ’° à°®à°¾à°°à±à°•à±†à°Ÿà± à°§à°°à°²à±", "à°ˆ à°°à±‹à°œà± à°µà°°à°¿ à°®à°‚à°¡à°¿ à°§à°° à°à°‚à°¤?"),
        ("ğŸ›ï¸ à°ªà±à°°à°­à±à°¤à±à°µ à°ªà°¥à°•à°¾à°²à±", "à°¨à°¾à°•à± à° à°ªà±à°°à°­à±à°¤à±à°µ à°ªà°¥à°•à°¾à°²à± à°…à°°à±à°¹à°¤ à°‰à°¨à±à°¨à°¾à°¯à°¿?"),
        ("ğŸŒ¤ï¸ à°µà°¾à°¤à°¾à°µà°°à°£à°‚", "à°¨à°¾ à°ªà±à°°à°¾à°‚à°¤à°‚à°²à±‹ à°µà°¾à°¤à°¾à°µà°°à°£ à°¸à±‚à°šà°¨ à°à°®à°¿à°Ÿà°¿?"),
        ("ğŸ§ª à°¨à±‡à°² à°†à°°à±‹à°—à±à°¯à°‚", "à°à°°à±à°° à°¨à±‡à°²à°•à± à°à°°à±à°µà±à°²à± à°¸à°¿à°«à°¾à°°à±à°¸à± à°šà±‡à°¯à°‚à°¡à°¿"),
    ],
    "hi": [
        ("ğŸŒ± à¤«à¤¸à¤² à¤°à¥‹à¤—", "à¤®à¥‡à¤°à¥€ à¤«à¤¸à¤² à¤®à¥‡à¤‚ à¤°à¥‹à¤— à¤²à¤—à¤¾ à¤¹à¥ˆ, à¤ªà¤¹à¤šà¤¾à¤¨ à¤•à¤°à¥‹"),
        ("ğŸ’° à¤®à¤‚à¤¡à¥€ à¤­à¤¾à¤µ", "à¤†à¤œ à¤šà¤¾à¤µà¤² à¤•à¤¾ à¤®à¤‚à¤¡à¥€ à¤­à¤¾à¤µ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?"),
        ("ğŸ›ï¸ à¤¸à¤°à¤•à¤¾à¤°à¥€ à¤¯à¥‹à¤œà¤¨à¤¾", "à¤®à¥à¤à¥‡ à¤•à¥Œà¤¨ à¤¸à¥€ à¤¸à¤°à¤•à¤¾à¤°à¥€ à¤¯à¥‹à¤œà¤¨à¤¾à¤à¤‚ à¤®à¤¿à¤² à¤¸à¤•à¤¤à¥€ à¤¹à¥ˆà¤‚?"),
        ("ğŸŒ¤ï¸ à¤®à¥Œà¤¸à¤®", "à¤®à¥‡à¤°à¥‡ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤•à¤¾ à¤®à¥Œà¤¸à¤® à¤•à¥ˆà¤¸à¤¾ à¤°à¤¹à¥‡à¤—à¤¾?"),
        ("ğŸ§ª à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯", "à¤²à¤¾à¤² à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤•à¥‡ à¤²à¤¿à¤ à¤–à¤¾à¤¦ à¤¸à¥à¤à¤¾à¤µ à¤¦à¥‡à¤‚"),
    ],
}


def render_sidebar() -> str:
    """Render the sidebar and return the selected language code."""
    with st.sidebar:
        # â”€â”€ Branding â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        st.markdown(
            """
            <div style="text-align:center; padding: 0.5rem 0 1rem 0;">
                <span style="font-size:2.8rem;">ğŸŒ¾</span>
                <h2 style="margin:0; color:#2e7d32;">KrishiSaathi</h2>
                <p style="margin:0; font-size:0.85rem; color:#666;">
                    AI Agricultural Advisory System</p>
            </div>
            """,
            unsafe_allow_html=True,
        )

        st.divider()

        # â”€â”€ Language selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        st.subheader("ğŸŒ Language / à°­à°¾à°·")

        # Build label â†’ code mapping
        lang_codes = list(LANGUAGE_LABELS.keys())
        lang_labels = list(LANGUAGE_LABELS.values())

        # Find the current index
        current_lang = st.session_state.get("language", Config.DEFAULT_LANGUAGE)
        try:
            current_idx = lang_codes.index(current_lang)
        except ValueError:
            current_idx = 0

        selected_label = st.selectbox(
            "Choose your language",
            options=lang_labels,
            index=current_idx,
            key="lang_selector",
            label_visibility="collapsed",
        )
        selected_code = lang_codes[lang_labels.index(selected_label)]

        # Detect language change
        if selected_code != st.session_state.get("language"):
            st.session_state["language"] = selected_code
            st.session_state["lang_changed"] = True
            st.rerun()
        else:
            st.session_state["lang_changed"] = False

        st.divider()

        # â”€â”€ Quick Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        lang = st.session_state.get("language", "en")
        actions = QUICK_ACTIONS.get(lang, QUICK_ACTIONS["en"])

        qa_header = {
            "en": "âš¡ Quick Actions",
            "te": "âš¡ à°¤à±à°µà°°à°¿à°¤ à°šà°°à±à°¯à°²à±",
            "hi": "âš¡ à¤¤à¥à¤µà¤°à¤¿à¤¤ à¤•à¤¾à¤°à¥à¤¯",
        }.get(lang, "âš¡ Quick Actions")
        st.subheader(qa_header)

        for label, query in actions:
            if st.button(label, key=f"qa_{label}", use_container_width=True):
                st.session_state["pending_query"] = query

        st.divider()

        # â”€â”€ Chat controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        clear_label = {"en": "ğŸ—‘ï¸ Clear Chat", "te": "ğŸ—‘ï¸ à°šà°¾à°Ÿà± à°•à±à°²à°¿à°¯à°°à±", "hi": "ğŸ—‘ï¸ à¤šà¥ˆà¤Ÿ à¤®à¤¿à¤Ÿà¤¾à¤à¤‚"}.get(lang, "ğŸ—‘ï¸ Clear Chat")
        if st.button(clear_label, use_container_width=True):
            st.session_state["messages"] = []
            st.session_state.pop("pending_query", None)
            st.rerun()

        # â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        st.divider()
        st.markdown(
            """
            <div style="text-align:center; font-size:0.75rem; color:#999;">
                <p>Built with â¤ï¸ for Indian Farmers</p>
                <p>Powered by Groq + Gemini + ChromaDB</p>
                <p style="margin-top:0.5rem;">Â© 2026 KrishiSaathi</p>
            </div>
            """,
            unsafe_allow_html=True,
        )

    return st.session_state.get("language", Config.DEFAULT_LANGUAGE)
